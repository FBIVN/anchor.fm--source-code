function unescapeUnicode(str) {
    if (str == '0') {
        return '0';
    }

    if (str === '') {
        return '';
    }

    if (str == null) {
        return null;
    }

    var newStr = str
        .toString()
        .replace(/\\u[a-fA-F0-9]{1,3}$/, '')
        .replace(/\\ud83d$/, '');

    newStr = newStr.replace(/\\u([a-fA-F0-9]{4})/g, function(g, m) {
        return String.fromCharCode(parseInt(m, 16));
    });

    // non-emoji, octal-escaped characters (iOS escapeUnicode escapes these)
    newStr = newStr.replace(/\\([0-9]{3})/g, function(m, p1) {
        return String.fromCharCode(parseInt(p1, 8));
    });

    return newStr || str;
}

module.exports = unescapeUnicode;
